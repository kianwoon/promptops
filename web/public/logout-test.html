<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logout Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .logout-btn {
            background-color: #dc3545;
            color: white;
        }
        .clear-btn {
            background-color: #6c757d;
            color: white;
        }
        .check-btn {
            background-color: #28a745;
            color: white;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”§ Logout Debugging Tool</h1>
        <p>This tool helps test and debug the logout functionality.</p>

        <div class="actions">
            <button class="logout-btn" onclick="simulateLogout()">Simulate Logout</button>
            <button class="clear-btn" onclick="clearAllAuthData()">Clear All Auth Data</button>
            <button class="check-btn" onclick="checkAuthStatus()">Check Auth Status</button>
        </div>

        <div id="status"></div>

        <h3>Current localStorage Contents:</h3>
        <pre id="localStorageContents"></pre>

        <h3>Auth Status:</h3>
        <pre id="authStatus"></pre>
    </div>

    <script>
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function simulateLogout() {
            showStatus('Simulating logout...', 'info');

            // Clear all auth data (mimicking the AuthContext logout)
            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('user');
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('dev_auth');
            localStorage.removeItem('auth_reloaded');

            // Set logout prevention flags
            localStorage.setItem('logout_manual', 'true');
            localStorage.setItem('dev_logout_disabled', 'true');
            localStorage.setItem('skip_dev_auth', 'true');
            localStorage.setItem('logout_timestamp', Date.now().toString());

            // Clear dev config
            localStorage.removeItem('dev_config');

            showStatus('Logout simulation completed! Check localStorage below.', 'success');
            updateDisplay();
        }

        function clearAllAuthData() {
            showStatus('Clearing all auth data...', 'info');

            // Clear all auth-related items
            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('user');
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('dev_auth');
            localStorage.removeItem('auth_reloaded');
            localStorage.removeItem('logout_manual');
            localStorage.removeItem('dev_logout_disabled');
            localStorage.removeItem('skip_dev_auth');
            localStorage.removeItem('logout_timestamp');
            localStorage.removeItem('dev_config');

            showStatus('All auth data cleared!', 'success');
            updateDisplay();
        }

        function checkAuthStatus() {
            showStatus('Checking authentication status...', 'info');

            const isAuthenticated = localStorage.getItem('isAuthenticated');
            const user = localStorage.getItem('user');
            const accessToken = localStorage.getItem('access_token');
            const logoutManual = localStorage.getItem('logout_manual');
            const devLogoutDisabled = localStorage.getItem('dev_logout_disabled');
            const skipDevAuth = localStorage.getItem('skip_dev_auth');
            const logoutTimestamp = localStorage.getItem('logout_timestamp');

            const status = {
                isAuthenticated: isAuthenticated === 'true',
                hasUserData: !!user,
                hasAccessToken: !!accessToken,
                logoutFlags: {
                    logoutManual: logoutManual === 'true',
                    devLogoutDisabled: devLogoutDisabled === 'true',
                    skipDevAuth: skipDevAuth === 'true',
                    logoutTimestamp: logoutTimestamp ? new Date(parseInt(logoutTimestamp)).toISOString() : null
                },
                logoutPrevented: logoutManual === 'true' || devLogoutDisabled === 'true' || skipDevAuth === 'true'
            };

            document.getElementById('authStatus').textContent = JSON.stringify(status, null, 2);

            if (status.logoutPrevented) {
                showStatus('Logout prevention flags are active - auto-auth should be disabled', 'info');
            } else if (status.isAuthenticated) {
                showStatus('User is currently authenticated', 'success');
            } else {
                showStatus('User is not authenticated', 'info');
            }
        }

        function updateDisplay() {
            // Display all localStorage items
            const items = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (key.includes('auth') || key.includes('dev') || key.includes('user') || key.includes('token'))) {
                    items[key] = localStorage.getItem(key);
                }
            }
            document.getElementById('localStorageContents').textContent = JSON.stringify(items, null, 2);

            // Update auth status
            checkAuthStatus();
        }

        // Initialize display
        updateDisplay();
    </script>
</body>
</html>