<!DOCTYPE html>
<html>
<head>
    <title>Avatar Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; margin: 5px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Avatar Test Page</h1>

    <div class="test-section">
        <h2>Testing Avatar URLs</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>Local Storage Check</h2>
        <div id="localStorage-check"></div>
    </div>

    <script>
        // Test various avatar URLs
        const testUrls = [
            'https://ui-avatars.com/api/?name=Development+User&background=0D8ABC&color=fff&format=svg',
            'https://avatars.githubusercontent.com/u/3683610?v=4',
            'https://lh3.googleusercontent.com/a/ACg8ocJBixoWqdPiPFJn_H7L6w71JR9FOS-S4StOZwIM5FmYwrG08Yg3=s96-c'
        ];

        const testResults = document.getElementById('test-results');

        testUrls.forEach((url, index) => {
            const testDiv = document.createElement('div');
            testDiv.innerHTML = `
                <h3>Test ${index + 1}: ${url}</h3>
                <div>Loading...</div>
            `;
            testResults.appendChild(testDiv);

            const img = new Image();
            img.onload = function() {
                testDiv.innerHTML = `
                    <h3>Test ${index + 1}: ${url}</h3>
                    <div class="success">✅ Avatar loaded successfully</div>
                    <img src="${url}" alt="Test avatar ${index + 1}" class="avatar">
                `;
            };
            img.onerror = function() {
                testDiv.innerHTML = `
                    <h3>Test ${index + 1}: ${url}</h3>
                    <div class="error">❌ Failed to load avatar</div>
                `;
            };
            img.src = url;
        });

        // Check localStorage
        const localStorageDiv = document.getElementById('localStorage-check');
        const items = ['isAuthenticated', 'user', 'access_token', 'dev_config'];

        items.forEach(item => {
            const value = localStorage.getItem(item);
            const displayValue = value ? (value.length > 100 ? value.substring(0, 100) + '...' : value) : 'null';
            localStorageDiv.innerHTML += `<div><strong>${item}:</strong> ${displayValue}</div>`;
        });

        // Try to parse user data
        const userStr = localStorage.getItem('user');
        if (userStr) {
            try {
                const user = JSON.parse(userStr);
                localStorageDiv.innerHTML += `
                    <h3>Parsed User Data:</h3>
                    <div><strong>Name:</strong> ${user.name}</div>
                    <div><strong>Email:</strong> ${user.email}</div>
                    <div><strong>Avatar:</strong> ${user.avatar || 'null'}</div>
                    <div><strong>Role:</strong> ${user.role}</div>
                `;

                // Test the user's avatar URL
                if (user.avatar) {
                    const userImg = new Image();
                    userImg.onload = function() {
                        localStorageDiv.innerHTML += `
                            <div class="success">✅ User avatar loads successfully</div>
                            <img src="${user.avatar}" alt="User avatar" class="avatar">
                        `;
                    };
                    userImg.onerror = function() {
                        localStorageDiv.innerHTML += `
                            <div class="error">❌ User avatar failed to load</div>
                        `;
                    };
                    userImg.src = user.avatar;
                }
            } catch (e) {
                localStorageDiv.innerHTML += `<div class="error">Error parsing user data: ${e.message}</div>`;
            }
        }
    </script>
</body>
</html>